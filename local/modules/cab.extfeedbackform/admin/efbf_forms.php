<?require_once($_SERVER["DOCUMENT_ROOT"]."/bitrix/modules/main/include/prolog_admin_before.php");$sTableID = "tbl_efbf_forms";$oSort = new CAdminSorting($sTableID, "ID", "asc");$lAdmin = new CAdminList($sTableID, $oSort);require_once($_SERVER["DOCUMENT_ROOT"]."/bitrix/modules/cab.extfeedbackform/prolog.php");$EFBF_RIGHT = $APPLICATION->GetGroupRight("cab.extfeedbackform");if($EFBF_RIGHT=="D") $APPLICATION->AuthForm(GetMessage("ACCESS_DENIED"));require_once($_SERVER["DOCUMENT_ROOT"]."/bitrix/modules/cab.extfeedbackform/include.php");IncludeModuleLangFile(__FILE__);$err_mess = "File: ".__FILE__."<br>Line: ";$arFilterFields = Array(	"find_id",	"find_code",	"find_code_exact_match",	"find_name",	"find_name_exact_match",	);/********************************************************************				Actions ********************************************************************/$lAdmin->InitFilter($arFilterFields);InitBVar($find_code_exact_match);InitBVar($find_name_exact_match);$arFilter = Array(	"ID"				=> $find_id,	"CODE"				=> $find_code,	"CODE_EXACT_MATCH"	=> $find_code_exact_match,	"NAME"				=> $find_name,	"NAME_EXACT_MATCH"	=> $find_name_exact_match,	);if ($lAdmin->EditAction() && $EFBF_RIGHT>="W" && check_bitrix_sessid()){	$bupdate = false;	foreach($FIELDS as $ID=>$arFields)	{		if(!$lAdmin->IsUpdated($ID))			continue;		$DB->StartTransaction();		$ID = IntVal($ID);		$arFieldsStore = Array(			"CODE"	=> "'".$DB->ForSql($arFields["CODE"])."'",			"NAME"	=> "'".$DB->ForSql($arFields["NAME"])."'",			);		if (!$DB->Update("cab_efbf_forms",$arFieldsStore,"WHERE ID='$ID'",$err_mess.__LINE__))		{			$lAdmin->AddUpdateError(GetMessage("SAVE_ERROR").$ID.": ".GetMessage("EFBF_FORMS_SAVE_ERROR"), $ID);			$DB->Rollback();		}		else			$bupdate = true;		$DB->Commit();	}}if(($arID = $lAdmin->GroupAction()) && $EFBF_RIGHT=="W" && check_bitrix_sessid()){        if($_REQUEST['action_target']=='selected')        {                $arID = Array();                $rsData = CEFBF_Forms::GetList(array($by => $order), $arFilter, $is_filtered);                while($arRes = $rsData->Fetch())                        $arID[] = $arRes['ID'];        }        foreach($arID as $ID)        {                if(strlen($ID)<=0)                        continue;                $ID = IntVal($ID);                switch($_REQUEST['action'])                {                case "delete":					@set_time_limit(0);					$DB->StartTransaction();					if(!CEFBF_Forms::Delete($ID))					{						$DB->Rollback();						$lAdmin->AddGroupError(GetMessage("DELETE_ERROR"), $ID);					}					$DB->Commit();					break;                }        }}$rsData = CEFBF_Forms::GetList(array($by => $order), $arFilter);$rsData = new CAdminResult($rsData, $sTableID);$rsData->NavStart();$lAdmin->NavText($rsData->GetNavPrint(GetMessage("EFBF_FORMS_PAGES")));$lAdmin->AddHeaders(array(		array("id"=>"ID", "content"=>"ID", "sort"=>"id", "default"=>true),		array("id"=>"CODE", "content"=>GetMessage("EFBF_CODE"), "sort"=>"code", "default"=>true),		array("id"=>"NAME", "content"=>GetMessage("EFBF_NAME"), "sort"=>"name", "default"=>true),	));while($arRes = $rsData->NavNext(true, "f_")){	$row =& $lAdmin->AddRow($f_ID, $arRes);	if ($EFBF_RIGHT=="W")	{		$row->AddInputField("CODE");		$row->AddInputField("NAME");	}	$row->AddViewField("ID", $f_ID);	$row->AddViewField("CODE", $f_CODE);	$row->AddViewField("NAME", $f_NAME);	$arActions = Array();		if($EFBF_RIGHT=="W")	{		$arActions[] = array("DEFAULT"=>"Y","ICON"=>"edit", "TEXT"=>GetMessage("MAIN_ADMIN_MENU_EDIT"), "ACTION"=>$lAdmin->ActionRedirect("cab.extfeedbackform_efbf_forms_edit.php?ID=".$f_ID));		$arActions[] = array("SEPARATOR"=>true);		$arActions[] = array("ICON"=>"delete", "TEXT"=>GetMessage("MAIN_ADMIN_MENU_DELETE"), "ACTION"=>"if(confirm('".GetMessage("EFBF_CONFIRM_DEL_FORM")."')) window.location='cab.extfeedbackform_efbf_forms.php?lang=".LANGUAGE_ID."&action=delete&ID=$f_ID&".bitrix_sessid_get()."'");				$row->AddActions($arActions);	}}$lAdmin->AddFooter(	array(		array("title"=>GetMessage("MAIN_ADMIN_LIST_SELECTED"), "value"=>$rsData->SelectedRowsCount()),		array("counter"=>true, "title"=>GetMessage("MAIN_ADMIN_LIST_CHECKED"), "value"=>"0"),	));if ($EFBF_RIGHT=="W")	$lAdmin->AddGroupActionTable(Array(		"delete"=>GetMessage("EFBF_FORM_DELETE"),		));if ($EFBF_RIGHT=="W"){	$aMenu[] = array(		"TEXT"	=> GetMessage("EFBF_FORM_CREATE"),		"TITLE"=>GetMessage("EFBF_FORM_CREATE_TITLE"),		"LINK"=>"cab.extfeedbackform_efbf_forms_edit.php?lang=".LANG,		"ICON" => "btn_new"	);		$aContext = $aMenu;	$lAdmin->AddAdminContextMenu($aContext);}$lAdmin->CheckListMode();/********************************************************************				Form********************************************************************/$APPLICATION->SetTitle(GetMessage("EFBF_PAGE_TITLE"));require_once ($_SERVER["DOCUMENT_ROOT"]."/bitrix/modules/main/include/prolog_admin_after.php");include($_SERVER["DOCUMENT_ROOT"]."/bitrix/modules/cab.extfeedbackform/include/logo.php");?><a name="tb"></a><form name="find_form" method="GET" action="<?=$APPLICATION->GetCurPage()?>?"><?$oFilter = new CAdminFilter(	$sTableID."_filter",	array(		GetMessage("EFBF_FLT_ID"),		GetMessage("EFBF_FLT_CODE"),		GetMessage("EFBF_FLT_NAME"),	));$oFilter->Begin();?><tr>	<td nowrap><b><?=GetMessage("EFBF_F_CODE")?></b></td>	<td nowrap><input type="text" name="find_code" value="<?echo htmlspecialchars($find_code)?>" size="50"><?=InputType("checkbox", "find_code_exact_match", "Y", $find_code_exact_match, false, "", "title='".GetMessage("EFBF_EXACT_MATCH")."'")?></td></tr><tr>	<td>ID:</td>	<td><input type="text" name="find_id" size="47" value="<?echo htmlspecialchars($find_id)?>"></td></tr><tr>	<td nowrap><?=GetMessage("EFBF_F_NAME")?></td>	<td nowrap><input type="text" name="find_name" value="<?echo htmlspecialchars($find_name)?>" size="50"><?=InputType("checkbox", "find_name_exact_match", "Y", $find_name_exact_match, false, "", "title='".GetMessage("EFBF_EXACT_MATCH")."'")?></td></tr><?$oFilter->Buttons(array("table_id"=>$sTableID, "url"=>$APPLICATION->GetCurPage(), "form"=>"find_form"));$oFilter->End();?></form><?$lAdmin->DisplayList();?><?require_once ($_SERVER["DOCUMENT_ROOT"]."/bitrix/modules/main/include/epilog_admin.php");?>